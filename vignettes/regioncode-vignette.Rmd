---
title: "regioncode: Convert Region Names and Division Codes of China Over Years"
author: 
  - "Yue Hu, Xinyi Ye, Wenquan Wu, Yufei Sun"
date: "`r Sys.Date()`"
output: 
    rmarkdown::html_vignette:
      keep_md: false
vignette: >
  %\VignetteEncoding{UTF-8}
  %\VignetteIndexEntry{regioncode: Convert Region Names and Division Codes of China Over Years}
  %\VignetteEngine{knitr::rmarkdown}

bibliography: s_regioncode.bib

editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE)

if(!require(regioncode)) install.packages("regioncode")
library(regioncode)
library(tidyverse)
```

"City" is a complex concept in China. 
It may refer to a county-level, prefectural, or provincial administrative unit.
Scholars of China often suffer from convert these names or corresponding geocodes, especially when dealing with data over years, since, for every a while, some unit's name may be modified or cancelled by the central government [@GuoJiaTongJiJu2022].

Inspired by Vincent Arel-Bundock's [`countrycode`](https://joss.theoj.org/papers/10.21105/joss.00848) package, we created `regioncode`, a package to achieve similar functions but specifically for region name/code conversions within China.
`regioncode` aims to enable seamlessly converting regions' formal names, common-used names, and administrative division codes between each other in modern China (1986--2019 in the current version).

# Why `regioncode`?

The Chinese government gives unique geocodes for each county, city (prefecture), and provincial-level administrative unit.
These "administrative division codes" are consistently [adjusted and updated](http://www.mca.gov.cn/article/sj/xzqh/1980/) to matched national and regional plans of development [@MinZhengBu2022].
The adjustments however may disturb researchers when they conduct studies over time or merge geo-based data from different years.
Especially, when researchers render statistical data on a Chinese map, different geocodes between map data and statistical data can cause mess-up outputs.

This package aims to conquer such difficulties by a one-step solution.
In the current version, `regioncode` enables seamlessly converting formal names, common-used names, language zone, and division codes of Chinese provinces and prefectures between each other and across thirty-four years from 1986 to 2019.

# Installation

To install:

-   the latest released version: `install.packages("regioncode")`.
-   the latest developing version: `remotes::install_github("sammo3182/regioncode")`.

# Basic Usage

We uses a randomly sample from the [`China's Corruption Investigations Dataset`](https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/9QZRAD) to illustrate how the functions work.


In `regioncode` package, we named administrative division codes as `code`, regions' formal names as `name`, and their commonly used abbreviation ("short name") as `sname`.
The current version enables mutual conversion between any pair of them.
To do so, users just need to pass a character vector of names or a numeric vector of geocodes into the function and specify which type of the output they want in the argument `convert_to` to gain the type of output of interest.
The current version includes three basic types of output (together with three types of extensions, `pinyin`, `dia_group`, and `rank`, elaborated in the next section):

1. Geocodes (`code`)
1. Names of the given cities/provinces (`name`)

In the following example, the 2019 geocodes in the toy data to their 1989 version.
Users need to correctly set the `year_from` argument to point to the proper reference.
Then they can use `year_to` and `convert_to` to set which year's projection should be output and in what type of format (e.g., geocodes or names in the following example).

```{r code2code}
library(regioncode)

data("corruption")

# Convert to the 1989 version
regioncode(data_input = corruption$prefecture_id, 
           convert_to = "code", # default set
           year_from = 2019,
           year_to = 1989)

# Comparision

tibble(
  code2019 = corruption$prefecture_id,
  code1989 = regioncode(data_input = corruption$prefecture_id,
           convert_to = "code", # default set
           year_from = 2019,
           year_to = 1989),
  name2019 = regioncode(data_input = corruption$prefecture_id,
           convert_to = "name", # default set
           year_from = 2019,
           year_to = 2019),
  name1989 = regioncode(data_input = corruption$prefecture_id,
           convert_to = "name", # default set
           year_from = 2019,
           year_to = 1989)
)
```

Note that if a region was initially geocoded in e.g., 1989 and included in a new region, in 2019, the new region geocode will be used hereafter.
If a big place was broken into several regions, the later-year codes will be aligned with the first region according to the ascendant order of the regions' numeric geocodes.

In the current version, `regioncode` automatically detects the input format: numerics for geocodes and characters for names.
The following example illustrate the conversions from different types of input to alternative formats of outputs:

```{r code2name}
# The original name
tibble(
  id = corruption$prefecture_id,
  name = corruption$prefecture
)

# Codes to name

regioncode(data_input = corruption$prefecture_id, 
           convert_to = "name",
           year_from = 2019,
           year_to = 1989)

# Name to codes of the same year
regioncode(data_input = corruption$prefecture, 
           convert_to = "code",
           year_from = 2019,
           year_to = 2019)

# Name to name of a different year

regioncode(data_input = corruption$prefecture, 
           convert_to = "name",
           year_from = 2019,
           year_to = 1989)
```

# Advanced Applications

To further help uses with more "messier" data and more diverse demands, `regioncode` provides several special converting functions.
They usually work for very specific data, but you will feel blessed that `regioncode` have these functions when you encounter those types of data. 
Such functions include:

1. Convert from and to names without administrative levels;
1. Convert from data regarding municipalities as cities;
1. Convert from provincial data;
1. Return pinyin spellings for the name;
1. Return sociopolitical areas; 
1. Return city ranks; 
1. Return linguistic zones.

## Incomplete naming prefectures.

More than often, data codes may omit the administrative levela when recording geo-information, for instnace, "北京" instead of "北京市", denoted as "incomplete names."
To accomplish conversions for such data, one needs to specify the `incomplete_name` argument:

- If the administrative level in the input data is incomplete, users should set `incomplete_name = "from"`;
- If the users need the output to be in the incomplete form (only working when `convert_to = "name"`), for instance, for later merging with other data, users should set `incomplete_name = "to"`;
- If both the input and output need to be in the in the incomplete form `incomplete_name = "both"`.

The above setting are illustrated in the example below, in which we convert the full names in the 2019 version to incomplete names in the 1989 version, and change it full names in 2008 in a next step:

```{r incomplete_name}
# Original full names
corruption$prefecture

# Convert to incomplete names in 1989
fake_incomplete <- regioncode(data_input = corruption$prefecture, 
           convert_to = "name",
           year_from = 2019,
           year_to = 1989,
           incomplete_name = "to")
fake_incomplete

# Convert to full names in 2008
fake_full <- regioncode(data_input = fake_incomplete, 
           convert_to = "name",
           year_from = 1989,
           year_to = 2008,
           incomplete_name = "from")
fake_full
```

## Municipalities

Municipalities ("直辖市") are geographically cities but administratively provincial.
When they are recognized as the provincial units, the districts within these municipalities are thus considered prefectural, according to the Chinese geocode system.
Nevertheless, different geographic data may treat them differently.
Some data (especially some socioeconomic statistics) may treat the municipalities equivalently as prefectures.

To convert this type of data, `regioncode` sets a specific argument `zhixiashi`.
The default value of the argument is "FALSE," by which the municipalities are treated as provinces.
When it is set "TRUE," the municipalities are treated as prefectures, and their provincial codes are used as the geocodes.

In the following example, we illustrate the municipalities identifier with a mixed string of names of municipalities, their districts, and a prefecture:

```{r municipality}
names_municipality <- c("北京", # Beijing, a municipality
                        "海淀区", # A district of Beijing
                        "上海", # Shanghai, a municipality
                        "静安区", # A district of Shanghai
                        "济南市") # A prefecture of Shandong

# When `zhixiashi` is FALSE, only the districts are recognized

regioncode(data_input = names_municipality, 
           year_from = 2019,
           year_to = 2019, 
           convert_to = "code",
           zhixiashi = FALSE)

# When `zhixiashi` is TRUE, muncipalities are 

# regioncode(data_input = names_municipality, 
#            year_from = 2019,
#            year_to = 2019, 
#            convert_to = "code",
#            zhixiashi = TRUE)
```

## City ranking

The *Statistical Yearbook of Urban and Rural Construction* divides Chinese cities into different levels from small cities to super cities, largely according to their populations [@GuoJiaTongJiJu2022a].
From 1989 to 2014, there were four levels of cities, and the system extend to a 7-level scale after 2014, as shown in the following table:

| criteria           | population                rank         
|:-------------------|-----------------------|------------------|
| old criteria(1989) | >1 million            |   超大城市       |
|                    | 500,000 ~ 1 million   |   大城市         |
|                    | 200,000 ~ 500,000     |   中等城市       |
|                    | <200,000              |   小城市         |
|                    |                       |                  |
|new criteria(2014)  | >10 million           |   超大城市       |
|                    | 5 million ~ 10 million|   特大城市       |
|                    | 3 million ~ 5 million |   I型大城市      |
|                    | 1 million ~ 3 million |   II型大城市     |
|                    | 500,000 ~ 1 million   |   中等城市       | 
|                    | 200,000 ~ 500,000     |   I型小城市      |
|                    | <200,000              |   II型小城市     |  

`regioncode` provides a function to return the rank of the cities according to their populations of the given year.
The population data were collected from the official statistics.
If the population is not traceable, the rank will be marked as `NA`.
Users just need to set `convert_to = "rank"` to conduct the conversion.
For the regions in and before 1989, the old ranking system is applied.
For the rest region-year, the function will return the new ranks.
In the following example, we compare the ranks from the same input in different years.

```{r rank}
tibble(
  city = corruption$prefecture,
  rank1989 = regioncode(data_input = corruption$prefecture, 
           year_from = 2019,
           year_to = 1989, 
           convert_to="rank"),
  rank2014 = regioncode(data_input = corruption$prefecture, 
           year_from = 2019,
           year_to = 2014, 
           convert_to = "rank")
)
```

## Pinyin^[Thanks Liu Xueyan's contribution to this function.]

Pinyin is a Chinese phonetic romanization.
Some data stores the region names with pinyin instead of Chinese characters.
The default name output of `regioncode` uses Chinese characters, but one can gain pinyin output by setting the argument `to_pinyin = TRUE`.
The effect can be applied to either official name, incomplete name, or sociopolitical area outputs.

```{r pinyin}
regioncode(data_input = corruption$prefecture, 
           year_from = 2019,
           year_to = 1989, 
           convert_to="name",
           to_pinyin=TRUE
           )

regioncode(data_input = corruption$prefecture, 
           year_from = 2019,
           year_to = 1989, 
           convert_to="name",
           incomplete_name = "to",
           to_pinyin=TRUE
           )

regioncode(data_input = corruption$prefecture, 
           year_from = 2019,
           year_to = 1989, 
           convert_to="area",
           to_pinyin=TRUE
           )
```

## Provinces

`regioncode` enables conversions at not only the prefectural but also the provincial level.
By setting the argument `province = TRUE`, users can convert all the geocodes and names at the provincial level.
Chinese provinces have abbreviations.
When the converted data only have abbreviations, users can set the `convert_to` argument to `abbreTocode`, `abbreToname`, or `abbreToarea` to gain the data types they want.
When they want abbreviation outputs, just set `convert_to = "abbre"`.

In the following example, we convert a vector of province geocodes to their official names and abbreviations.

```{r provinces}
tibble(
  province = corruption$province_id,
  prov_name = regioncode(data_input = corruption$province_id, 
           convert_to = "name",
           year_from = 2019,
           year_to = 1989,
           province = TRUE),
  prov_abbre = regioncode(data_input = corruption$province_id, 
           convert_to = "codeToabbre",
           year_from = 2019,
           year_to = 1989,
           province = TRUE)
)

```

## Geographic Units Beyond Provinces

The current version of `regioncode` includes two types of region conversion beyond the provincial level: administrative area and linguistic zones.

### Administrative Area

Due to social, political, and martial reasons, Chinese regions are divided into seven areas [@SunPing2020]:

| region | provincial-level administrative unit                           |
|:-------|----------------------------------------------------------------|
| 华北   | 北京市, 天津市, 山西省, 河北省, 内蒙古自治区                   |
| 东北   | 黑龙江省, 吉林省, 辽宁省                                       |
| 华东   | 上海市, 江苏省, 浙江省, 安徽省, 福建省, 台湾省, 江西省, 山东省 |
| 华中   | 河南省, 湖北省, 湖南省                                         |
| 华南   | 广东省, 海南省, 广西壮族自治区, 香港特别行政区, 澳门特别行政区 |
| 西南   | 重庆市, 四川省, 贵州省, 云南省, 西藏自治区                     |
| 西北   | 陕西省, 甘肃省, 青海省, 宁夏回族自治区, 新疆维吾尔自治区       |


In some cases, users may want to know which areas a prefecture or province belongs.
`regioncode` offers a function to convert codes and names of the region (both prefectures and provinces) into areas by setting the output format as "area":

```{r 2area}
regioncode(data_input = corruption$prefecture, 
           year_from = 2019,
           year_to = 1989, 
           convert_to = "area")
```

### Linguistic Zone^[Thanks ZHU Meng's contribution to this function.]

China is a multilingual country with a variety of dialects.
These dialects may be used by several prefectures in a province or province.
Prefectures from different provinces may also share the same dialect.

For the convenience of political and sociolinguistic studies, `regioncode` includes a function to return approximate linguistic zones of the given geocodes or prefectural names.
In the current version, `regioncode` offers two levels of lignuistic zone identification, i.e., the dialect groups (`dia_group`, "方言大类") and dialect sub-groups (`dia_sub_group`, "分区片"), according to the 1987 language atlas of China [@LiEtAl1987].^[Adding the 2012 version is a project on the list [@LanguageInstitutionEtAl2012].]
(When `province = TRUE`, the linguistic conversion can be only to the dialect group level.) 

In the following example, we convert the toy data to dialect groups and sub-groups:

```{r language_zone}
tibble(
  city = corruption$prefecture,
  dialectGroup = regioncode(data_input = corruption$prefecture, 
           year_from = 2019,
           year_to = 1989,
           to_dialect = "dia_group"),
  dialectSubGroup = regioncode(data_input = corruption$prefecture, 
           year_from = 2019,
           year_to = 1989,
           to_dialect = "dia_sub_group")
)
```

Note that, the linguistic distribution in China is too complex for precisely gauging at the prefectural level, not saying that they continually change along with the population dynamic.
The linguistic zone output from `regioncode` is thus at most for reference rather than rigorous linguistic research.

## Conclusion

`regioncode` provides a convenient way to convert Chinese administrative division codes, official names, sociopolitical and linguistic areas, abbreviations, and so on between each other.
This vignette offers a quick view of package features and a short tutorial for users.

The development of the package is ongoing.
Future versions aim to add more administrative level choices, from province level to county level.
Data are also enriching.
Welcome to join us if you are also interested (see the affiliations below).
Please contact us with any questions or comments.
Bug reports can be conducted by [Github Issues](https://github.com/sammo3182/regioncode/issues).

We appreciate the efforts of SHI Yuyang, XU Yujia, TIAN Haiting, SHAO Weihang, CHEN Yuanqian, and  LI Ruizhe's on data collection and function editing of this package. 

## Affiliation

Dr. Yue Hu

Department of Political Science,\
Tsinghua University,\
Email: [yuehu\@tsinghua.edu.cn](mailto:yuehu@tsinghua.edu.cn){.email}\
Website: <https://sammo3182.github.io>

Xinyi Ye

Department of Political Science,\
Tsinghua University,\
Email: [yexinyi98\@outlook.com](mailto:yexinyi98@outlook.com){.email}
